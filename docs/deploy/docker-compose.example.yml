# Example Docker Compose for production deploy (Docker + Caddy + SQLite)
# Copy to your server (DO NOT commit real secrets), adjust placeholders,
# and run: docker compose up -d

services:
  app:
    build: .
    environment:
      # Replace with your public URL
      NEXTAUTH_URL: https://YOUR_DOMAIN
      # Generate a strong random secret (min 32 chars) and keep it stable
      NEXTAUTH_SECRET: "REPLACE_WITH_STRONG_SECRET"
      # SQLite file in bind-mount. Keep the host dir persistent.
      DATABASE_URL: file:/data/panel.db
      # --- Cloudflare R2 (S3 compatible) ---
      # Endpoint: https://<accountid>.r2.cloudflarestorage.com or your custom domain
      R2_ENDPOINT: https://<accountid>.r2.cloudflarestorage.com
      # Region for R2: usually "auto"
      R2_REGION: auto
      # Credentials: create an R2 API Token with "Edit" permissions for the bucket
      R2_ACCESS_KEY_ID: "REPLACE_WITH_ACCESS_KEY"
      R2_SECRET_ACCESS_KEY: "REPLACE_WITH_SECRET_KEY"
      # Bucket name and public base URL (custom domain strongly recommended)
      R2_BUCKET: b2b-primepodloga
      # If using custom domain mapped to the bucket: e.g. https://cdn.twojadomena.pl
      # If using the default public URL, include the bucket segment, e.g.
      # https://<accountid>.r2.cloudflarestorage.com/b2b-primepodloga
      R2_PUBLIC_BASE_URL: https://cdn.YOUR_DOMAIN
    volumes:
      - /srv/prime/data:/data
    restart: unless-stopped

  caddy:
    image: caddy:2
    ports:
      - "80:80"
      - "443:443"
    # Mount a file â†’ file: ensure the left path is a FILE on host
    volumes:
      - /srv/prime/caddy/Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    restart: unless-stopped

volumes:
  caddy_data: {}
  caddy_config: {}
